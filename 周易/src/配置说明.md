# 周易占卜系统配置说明

## 📁 配置文件
配置文件位置：`config.json`

## ⚙️ 配置项说明

### 🌐 服务器配置 (server)
```json
{
    "server": {
        "port": "8090"
    }
}
```

- **port**: HTTP服务器监听端口
  - 默认值：`"8090"`
  - 说明：程序启动后可访问 `http://localhost:端口号/api/divine`
  - 示例：修改为 `"9000"` 后访问地址为 `http://localhost:9000/api/divine`

### 📅 万年历API配置 (calendar)
```json
{
    "calendar": {
        "api_host": "https://cn.apihz.cn",
        "id": "88888888", 
        "key": "88888888"
    }
}
```

- **api_host**: 万年历API服务器地址
  - 默认值：`"https://cn.apihz.cn"`
  - 说明：万年历数据源API地址，来源：[接口盒子](https://cn.apihz.cn)
  
- **id**: API用户ID
  - 默认值：`"88888888"`
  - 说明：访问万年历API的用户标识
  
- **key**: API密钥
  - 默认值：`"88888888"`
  - 说明：访问万年历API的密钥

⚠️ **重要提示：示例中的ID与KEY为公共ID与KEY**
- 公共ID与KEY共享每分钟调用频次限制
- 接口本身免费，但建议使用自己的ID与KEY
- 使用自己的ID与KEY可独享每分钟调用频次，每日调用无上限
- 获取个人ID与KEY：访问 [接口盒子官网](https://www.apihz.cn) 注册账号

### 🧹 文件清理配置 (cleanup)
```json
{
    "cleanup": {
        "enabled": true,
        "max_age": 24,
        "clean_on_start": true
    }
}
```

- **enabled**: 是否启用自动清理功能
  - 默认值：`true`
  - 说明：控制是否自动清理photos目录中的过期图片文件
  - 设置为 `false` 可完全禁用清理功能

- **max_age**: 文件最大保存时间（小时）
  - 默认值：`24`
  - 说明：图片文件超过此时间后将被自动删除
  - 示例：设置为 `48` 表示保存48小时（2天）
  - 设置为 `0` 或负数将禁用清理功能

- **clean_on_start**: 程序启动时是否执行清理
  - 默认值：`true`
  - 说明：程序每次启动时是否自动执行一次清理操作
  - 设置为 `false` 仅在定时任务中执行清理

🔄 **清理机制说明**：
- 系统每小时自动检查一次photos目录
- 删除修改时间超过配置时间的图片文件
- 清理操作会在日志中记录详细信息
- 清理不会影响正在使用的图片文件

## 🔧 如何修改配置

### 方法1：直接编辑配置文件
1. 用记事本或其他文本编辑器打开 `config.json`
2. 修改相应的配置值
3. 保存文件
4. 重新启动程序

### 方法2：删除配置文件重新生成
1. 删除 `config.json` 文件
2. 启动程序，会自动生成默认配置文件
3. 按需修改生成的配置文件

## 📝 配置示例

### 示例1：更改端口和文件清理设置
```json
{
    "server": {
        "port": "9000"
    },
    "calendar": {
        "api_host": "http://101.35.2.25",
        "id": "10005598",
        "key": "12345678910"
    },
    "cleanup": {
        "enabled": true,
        "max_age": 48,
        "clean_on_start": true
    }
}
```

### 示例2：使用个人万年历API密钥
```json
{
    "server": {
        "port": "8090"
    },
    "calendar": {
        "api_host": "https://cn.apihz.cn",
        "id": "your-personal-id",
        "key": "your-personal-key"
    },
    "cleanup": {
        "enabled": true,
        "max_age": 24,
        "clean_on_start": true
    }
}
```

### 示例3：禁用文件清理
```json
{
    "server": {
        "port": "8090"
    },
    "calendar": {
        "api_host": "https://cn.apihz.cn",
        "id": "88888888",
        "key": "88888888"
    },
    "cleanup": {
        "enabled": false,
        "max_age": 24,
        "clean_on_start": false
    }
}
```

## ⚠️ 注意事项

1. **JSON格式要求**：
   - 必须使用双引号 `"` 包围字符串
   - 注意逗号和大括号的正确使用
   - 不要在最后一个配置项后加逗号

2. **端口配置**：
   - 端口号范围：1-65535
   - 避免使用被其他程序占用的端口
   - 常用端口如80、443、8080可能被占用

3. **万年历API**：
   - 确保API地址可正常访问
   - 验证ID和密钥的有效性
   - 网络连接异常时会影响卦象生成

## 🛠️ 故障排除

### 配置文件格式错误
- 症状：程序启动时报JSON解析错误
- 解决：检查JSON语法，可使用在线JSON校验工具

### 端口被占用
- 症状：程序启动时报端口绑定失败
- 解决：修改为其他可用端口

### 万年历API无法访问
- 症状：卦象生成时日期信息获取失败
- 解决：检查网络连接和API配置信息

### API调用频次限制
- 症状：API返回"调用频次过快，请间隔一分钟再试"
- 原因：使用公共ID与KEY，触发频次限制
- 解决方案：
  1. 等待一分钟后重试
  2. 访问 [接口盒子官网](https://www.apihz.cn) 注册获取个人ID与KEY
  3. 在配置文件中替换为个人ID与KEY，享受独享频次

## 📞 技术支持
如遇配置问题，请检查程序运行日志获取更多错误信息。 